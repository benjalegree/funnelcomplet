<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Landing â€” Opt-in</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{--bg:#f8fafc;--fg:#0b1220;--muted:#475569;--line:#e5e7eb;--brand:#0b5fff}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:920px;margin:0 auto;padding:24px}
  .card{background:#fff;border:1px solid var(--line);border-radius:14px;padding:22px;box-shadow:0 6px 18px rgba(2,6,23,.06)}
  h1{margin:0 0 8px;font-size:32px}
  p{margin:0 0 14px;color:var(--muted)}
  label{display:block;font-weight:700;font-size:13px;margin:12px 0 6px}
  input,button{font:inherit}
  input[type="text"],input[type="email"],input[type="tel"]{width:100%;padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:640px){.row{grid-template-columns:1fr}}
  button{padding:12px 16px;border-radius:999px;border:0;background:var(--brand);color:#fff;font-weight:800;cursor:pointer}
  .status{margin-left:10px;color:var(--muted)}
</style>
</head>
<body>
  <main class="wrap">
    <div class="card">
      <h1>Recibe la guÃ­a gratuita</h1>
      <p>Deja tu email y te enviamos el recurso al instante.</p>

      <form id="leadForm" autocomplete="on">
        <label>Email</label>
        <input type="email" name="email" required placeholder="tu@correo.com">

        <div class="row">
          <div>
            <label>Nombre (opcional)</label>
            <input type="text" name="name" placeholder="Tu nombre">
          </div>
          <div>
            <label>TelÃ©fono (opcional)</label>
            <input type="tel" name="phone" placeholder="+34 600 000 000">
          </div>
        </div>

        <!-- CAMBIA SOLO ESTO: tu slug de proyecto -->
        <input type="hidden" name="project_slug" value="respira21">

        <!-- Hidden tÃ©cnicos (no toques) -->
        <input type="hidden" name="page_url" value="">
        <input type="hidden" name="utm_source" value="">
        <input type="hidden" name="utm_medium" value="">
        <input type="hidden" name="utm_campaign" value="">
        <input type="hidden" name="utm_term" value="">
        <input type="hidden" name="utm_content" value="">

        <div style="margin-top:14px; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
          <button type="submit" id="btnSubmit">Quiero la guÃ­a</button>
          <span class="status" id="formMessage">â€”</span>
        </div>
      </form>
    </div>
  </main>

<script>
(function(){
  const ENDPOINT = "https://script.google.com/macros/s/AKfycbxe8mPiH2ToslKtQqM-JyuZzZuJQGgkPEF0_6Vk4evQ2-FMTW-g-qWRr3d0YNz8_v3dVw/exec";
  const API_KEY  = "pon-un-secreto-simple-aqui";

  const form = document.getElementById('leadForm');
  const msg  = document.getElementById('formMessage') || document.createElement('span');
  if(!msg.id){ msg.id='formMessage'; form.appendChild(msg); }

  // Completa page_url y UTM
  (function setParams(){
    const set = (n,v)=>{ const el=form.querySelector(`[name="${n}"]`); if(el) el.value=v||''; };
    set('page_url', location.href);
    const q = new URLSearchParams(location.search);
    ['utm_source','utm_medium','utm_campaign','utm_term','utm_content'].forEach(k=> set(k, q.get(k)));
  })();

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const btn = form.querySelector('button[type="submit"]') || form.querySelector('button');
    const prev = btn ? btn.textContent : '';
    if(btn){ btn.disabled = true; btn.textContent = 'Enviandoâ€¦'; }
    msg.textContent = 'Enviandoâ€¦';

    const data = Object.fromEntries(new FormData(form).entries());
    data.action = 'upsert';
    data._key   = API_KEY;

    try{
      const r = await fetch(ENDPOINT, {
        method:'POST',
        // ðŸ‘‡ clave del arreglo: usar text/plain para evitar preflight CORS
        headers:{ 'Content-Type':'text/plain;charset=UTF-8' },
        body: JSON.stringify(data)
      });
      const txt = await r.text();
      let json; try { json = JSON.parse(txt); } catch(e){ throw new Error('Respuesta no JSON: ' + txt.slice(0,160)); }
      if (json.ok){
        msg.textContent = 'Â¡Listo! Revisa tu correo.';
        form.reset();
      } else {
        msg.textContent = 'Error: ' + (json.error || 'IntÃ©ntalo de nuevo.');
        if(btn){ btn.disabled = false; btn.textContent = prev; }
      }
    }catch(err){
      msg.textContent = 'Error: ' + (err.message || 'Sin conexiÃ³n.');
      if(btn){ btn.disabled = false; btn.textContent = prev; }
    }
  });
})();
</script>

</body>
</html>
