<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recursos Gratuitos · PsicoFunnel</title>
  <meta name="description" content="Accede a plantillas, ebooks y webinars gratuitos para optimizar tus funnels.">

  <!-- Fuentes y librerías -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="https://kit.fontawesome.com/a3f4e7b8d1.js" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.8.1/dist/vanilla-tilt.min.js" defer></script>

  <!-- Supabase client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <style>
    :root {
      --navy: #001a40;
      --accent: #00a6e0;
      --radius: 1.8rem;
      --shadow: 0 14px 34px rgba(0,0,0,.17);
      --glow: 0 0 12px rgba(0,166,224,.55);
      --white: #fff;
      --dark-bg: #000e20;
    }
    *,*::before,*::after { box-sizing:border-box; margin:0; padding:0 }
    html, body { max-width:100%; overflow-x:hidden; scroll-behavior:smooth; font-family:'Outfit',sans-serif; color:#0a0f1c; text-align:center }
    .container { width:min(1180px,92%); margin-inline:auto }

    /* Fondo animado */
    body::before {
      content:""; position:fixed; inset:0; z-index:-2;
      background:linear-gradient(-45deg,#0043a3,var(--navy),#000e20,#0043a3);
      background-size:400% 400%; animation:bg 25s ease infinite;
    }
    @keyframes bg {0%,100%{background-position:0 50%}50%{background-position:100% 50%}}

    /* Botón */
    .btn { display:inline-block;padding:.9rem 1.8rem;border-radius:3rem;font-weight:700;background:var(--accent);color:var(--white);text-decoration:none;transition:.3s }
    .btn:hover { transform:translateY(-3px);box-shadow:var(--glow) }

    /* Navbar */
    .header{position:fixed;top:0;left:0;width:100%;backdrop-filter:blur(12px);background:rgba(0,15,40,.6);z-index:1000}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:16px min(4vw,32px)}
    .logo{color:var(--white);font-size:1.3rem;font-weight:700;text-decoration:none}
    .nav-links a{color:var(--white);margin-left:22px;font-weight:600;transition:.25s}
    .nav-links a:hover{opacity:.75}
    #toggle{display:none}
    .burger{display:none;width:28px;height:22px;cursor:pointer;position:relative}
    .burger span,.burger::before,.burger::after{content:"";position:absolute;left:0;width:100%;height:3px;background:#fff;transition:.3s}
    .burger span{top:9px}.burger::before{top:0}.burger::after{bottom:0}
    #toggle:checked + .burger span{background:transparent}
    #toggle:checked + .burger::before{transform:rotate(45deg) translate(5px,5px)}
    #toggle:checked + .burger::after{transform:rotate(-45deg) translate(5px,-5px)}
    @media(max-width:780px){
      .burger{display:block}
      .nav-links{position:fixed;top:0;right:-80vw;width:80vw;height:100vh;background:var(--dark-bg);display:flex;flex-direction:column;align-items:center;padding-top:100px;transition:right .4s}
      #toggle:checked ~ .nav-links{right:0}
      .nav-links a{margin:18px;font-size:1.15rem}
    }

    /* Hero */
    header{padding:180px 1rem 120px;color:var(--white)}
    header h1{font-size:clamp(2.6rem,6vw,4.6rem);font-weight:700}
    header p{font-size:1.1rem;max-width:600px;margin:.8rem auto 0}
    header .btn{margin-top:2rem}

    /* Secciones */
    section{padding:80px 0}
    h2{font-size:2.1rem;margin-bottom:1rem}
    .grid{display:grid;gap:1.8rem}
    @media(min-width:768px){.grid-2{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1024px){.grid-3{grid-template-columns:repeat(3,1fr)}}

    /* Tarjetas recursos */
    .resources .card{background:var(--white);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;transition:.3s;text-align:left}
    .resources .card:hover{transform:translateY(-6px);box-shadow:var(--glow)}
    .resources .card img{width:100%;height:180px;object-fit:cover}
    .resources .card-content{padding:1.5rem}
    .resources .card-content h3{font-size:1.2rem;margin-bottom:.6rem}
    .resources .card-content p{font-size:.95rem;margin-bottom:1.2rem}

    /* Newsletter */
    .newsletter{background:var(--navy);color:var(--white)}
    .newsletter form{display:flex;gap:.7rem;justify-content:center;margin-top:1rem}
    .newsletter input{flex:1;padding:.8rem;border:1px solid #3c4e7a;border-radius:2rem;background:var(--navy);color:var(--white)}
    .newsletter input::placeholder{color:#cfd8ff}
    @media(max-width:580px){.newsletter form{flex-direction:column}}

    /* Admin button */
    .admin-btn{position:fixed;bottom:20px;left:20px;background:var(--accent);color:#000;padding:.5rem;cursor:pointer;border-radius:.5rem;font-size:1.2rem;box-shadow:var(--shadow);z-index:1001}

    /* Admin panel */
    #admin-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--white);padding:2rem;border-radius:var(--radius);box-shadow:var(--shadow);z-index:1002;display:none;max-width:400px;width:90%}
    #admin-panel h3{margin-bottom:1rem}
    #admin-panel input,#admin-panel textarea{width:100%;margin-bottom:.8rem;padding:.6rem;border:1px solid #ccc;border-radius:.5rem;font-family:inherit}
    #admin-panel label{font-weight:600;text-align:left;display:block;margin-bottom:.3rem}
    #admin-panel .btn{width:100%}

    /* Overlay */
    #overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;display:none}
  </style>
</head>
<body>

  <!-- Navbar -->
  <div class="header">
    <nav class="nav container">
      <a class="logo" href="/">PsicoFunnel</a>
      <input type="checkbox" id="toggle">
      <label for="toggle" class="burger"><span></span></label>
      <div class="nav-links">
        <a href="/">Inicio</a>
        <a href="/servicio.html">Servicios</a>
        <a href="/BLOG.html">Blog</a>
        <a href="/contacto.html">Contacto</a>
      </div>
    </nav>
  </div>

  <!-- Hero -->
  <header>
    <div class="container" data-aos="fade-down">
      <h1>Recursos Gratuitos</h1>
      <p>Descarga plantillas, ebooks y webinars para optimizar tus funnels.</p>
      <a href="#recursos" class="btn">Ver recursos ↓</a>
    </div>
  </header>

  <!-- Recursos -->
  <section id="recursos" class="resources">
    <div class="container" data-aos="fade-up">
      <h2>Elige tu recurso</h2>
      <div id="resources-container" class="grid grid-3"></div>
    </div>
  </section>

  <!-- Newsletter -->
  <section class="newsletter" data-aos="fade-up">
    <div class="container">
      <h2>Únete a La Fraternidad</h2>
      <p>Recibe hacks de psicología y funnels cada domingo. ¡Gratis!</p>
      <form id="newsletter-form">
        <input type="hidden" name="tag" value="recursos">
        <input type="email" name="email" placeholder="Tu email" required>
        <button class="btn" type="submit">Suscribirme</button>
      </form>
    </div>
  </section>

  <!-- Admin button -->
  <div class="admin-btn" id="admin-btn" title="Panel Admin">⚙️</div>
  <div id="overlay"></div>

  <!-- Admin panel -->
  <div id="admin-panel">
    <h3>Agregar Recurso</h3>
    <label for="res-title">Título</label>
    <input id="res-title" type="text" placeholder="Nombre del recurso">
    <label for="res-desc">Descripción</label>
    <textarea id="res-desc" rows="3" placeholder="Breve descripción"></textarea>
    <label for="res-img">URL de la imagen</label>
    <input id="res-img" type="text" placeholder="https://...">
    <label for="res-link">Enlace de descarga</label>
    <input id="res-link" type="text" placeholder="/squeeze-page.html">
    <button class="btn" id="add-resource">Agregar recurso</button>
  </div>

  <!-- Footer + scrollTop -->
  <footer>
    <p>&copy; <span id="year"></span> PsicoFunnel · Con ciencia y corazón · <a href="#top">Subir ↑</a></p>
  </footer>
  <div class="scrolltop" id="topbtn" aria-label="Volver arriba"><i class="fas fa-arrow-up"></i></div>

  <!-- Scripts -->
  <script>
    // 1) Inicializa Supabase
    const SUPA_URL = 'https://ysjbznqgcxhvrkraxmsh.supabase.co';
    const SUPA_KEY = 'eyJTU_ANON_KEY_AQUÍ';  // reemplaza con tu anon public key
    const supabase = supabasejs.createClient(SUPA_URL, SUPA_KEY);

    // 2) Función para guardar suscriptor + webhook
    async function saveSubscriber(email) {
      // Supabase insert
      const { error } = await supabase
        .from('DB-SUBS')
        .insert([{ email, code: '' }]);
      if (error) console.error('Supabase error:', error);
      return !error;
    }

    // Recursos por defecto
    const defaultResources = [
      { title:'Ebook: Plantillas de Funnel', desc:'Plantillas TOFU/MOFU/BOFU listas para usar.', img:'IMG_EBOOK_COVER', link:'/squeeze-page.html' },
      { title:'Pack de Templates',      desc:'Landing, emails y pop-ups personalizables.',         img:'IMG_TEMPLATE_PACK', link:'/templates.html' },
      { title:'Webinar Grabado',        desc:'Cómo diseñar funnels que convierten.',               img:'IMG_WEBINAR', link:'/webinar.html' }
    ];

    // Cargar recursos: default + extras de localStorage
    function loadResources() {
      const extras = JSON.parse(localStorage.getItem('resources')||'[]');
      return [...defaultResources, ...extras];
    }

    // Renderizar en DOM
    function renderResources() {
      const container = document.getElementById('resources-container');
      container.innerHTML = '';
      loadResources().forEach(r => {
        const card = document.createElement('div');
        card.className = 'card'; card.setAttribute('data-tilt','');
        card.innerHTML = `
          <img src="${r.img}" alt="${r.title}">
          <div class="card-content">
            <h3>${r.title}</h3>
            <p>${r.desc}</p>
            <a href="${r.link}" class="btn">Acceder</a>
          </div>`;
        container.appendChild(card);
      });
      VanillaTilt.init(document.querySelectorAll('[data-tilt]'),{max:6,speed:400,glare:true,'max-glare':.25});
    }

    // Admin panel lógica
    const ADMIN_PW = 'MiPassword123';
    const adminBtn = document.getElementById('admin-btn');
    const overlay  = document.getElementById('overlay');
    const panel    = document.getElementById('admin-panel');

    adminBtn.addEventListener('click',()=>{
      const pw = prompt('Contraseña admin:');
      if(pw===ADMIN_PW) {
        overlay.style.display='block'; panel.style.display='block';
      }
    });
    overlay.addEventListener('click',()=>{
      overlay.style.display='none'; panel.style.display='none';
    });
    document.getElementById('add-resource').addEventListener('click',()=>{
      const title = document.getElementById('res-title').value.trim();
      const desc  = document.getElementById('res-desc').value.trim();
      const img   = document.getElementById('res-img').value.trim();
      const link  = document.getElementById('res-link').value.trim();
      if(title && desc && img && link) {
        const extras = JSON.parse(localStorage.getItem('resources')||'[]');
        extras.push({title,desc,img,link});
        localStorage.setItem('resources', JSON.stringify(extras));
        renderResources();
        alert('Recurso agregado!');
        overlay.style.display='none'; panel.style.display='none';
      } else {
        alert('Completa todos los campos');
      }
    });

    document.addEventListener('DOMContentLoaded',()=>{
      AOS.init({duration:800,once:true});
      document.getElementById('year').textContent=new Date().getFullYear();

      // Newsletter: Supabase + Webhook
      document.getElementById('newsletter-form').addEventListener('submit', async e=>{
        e.preventDefault();
        const email = e.target.email.value.trim();
        if (!email) return alert('Ingresa un email válido');

        // 1) Guardar en Supabase
        const ok = await saveSubscriber(email);
        if (!ok) return alert('Error al suscribir. Intenta más tarde.');

        // 2) Disparar webhook para enviar email
        fetch('https://hook.us2.make.com/l1h37pmaijehhv6h6l2ripgv2ial94ii', {
          method: 'POST',
          body: new FormData(e.target)
        })
        .then(r => r.ok
          ? alert('¡Te enviamos los recursos al correo!')
          : alert('Error enviando el correo.')
        )
        .catch(()=> alert('Error de conexión.'));

        e.target.reset();
      });

      // Scroll-top
      const topBtn = document.getElementById('topbtn');
      window.addEventListener('scroll',()=> topBtn.classList.toggle('show',window.scrollY>400));
      topBtn.addEventListener('click',()=> window.scrollTo({top:0,behavior:'smooth'}));

      // Render final
      renderResources();
    });
  </script>
</body>
</html>

